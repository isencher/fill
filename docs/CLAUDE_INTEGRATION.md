# Claude Code é›†æˆæŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å°†è‡ªåŠ¨åŒ–å¼€å‘æ‰§è¡Œç³»ç»Ÿä¸ Claude Code æ·±åº¦é›†æˆã€‚

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Code                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·è¾“å…¥ â†’ Hook é¢„å¤„ç† â†’ MCP å·¥å…· â†’ Hook åå¤„ç†          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è‡ªåŠ¨åŒ–å¼€å‘æ‰§è¡Œç³»ç»Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è´Ÿåé¦ˆæ§åˆ¶ â†’ ä¿¡ä»»è¯„åˆ† â†’ æ‰¹é‡å†³ç­– â†’ è‡ªåŠ¨å›æ»š               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é›†æˆç»„ä»¶

### 1. MCP æœåŠ¡å™¨ (`mcp_automation_server.py`)

å°†è‡ªåŠ¨åŒ–ç³»ç»Ÿçš„åŠŸèƒ½æš´éœ²ä¸º Claude å¯è°ƒç”¨çš„å·¥å…·ï¼š

| MCP å·¥å…· | åŠŸèƒ½ |
|----------|------|
| `automation_execute` | æ‰§è¡Œè‡ªåŠ¨åŒ–æ“ä½œ |
| `automation_get_trust` | è·å–ä¿¡ä»»åˆ†æ•° |
| `automation_get_queue` | æŸ¥çœ‹å†³ç­–é˜Ÿåˆ— |
| `automation_approve_queue` | æ‰¹é‡æ‰¹å‡† |
| `automation_get_audit` | è·å–å®¡è®¡æŠ¥å‘Š |
| `automation_create_rollback` | åˆ›å»ºå›æ»šç‚¹ |
| `automation_rollback` | æ‰§è¡Œå›æ»š |

### 2. Claude Hooks (`.claude/hooks/automation.py`)

| Hook | è§¦å‘æ—¶æœº | åŠŸèƒ½ |
|-------|---------|------|
| `PreToolUse` | Claude ä½¿ç”¨å·¥å…·å‰ | æ£€æŸ¥æ“ä½œæƒé™ï¼Œé˜»æ­¢æˆ–å»ºè®® |
| `PostToolUse` | Claude ä½¿ç”¨å·¥å…·å | æµ‹é‡ç»“æœï¼Œæ›´æ–°ä¿¡ä»»åˆ†æ•° |
| `UserPromptSubmit` | ç”¨æˆ·æäº¤æç¤ºæ—¶ | æ·»åŠ é¡¹ç›®ä¸Šä¸‹æ–‡ |

## å·¥ä½œæµç¨‹

### åœºæ™¯ 1: Claude åˆ›å»ºæ–°æ–‡ä»¶

```
ç”¨æˆ·: "åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ tests/test_user.py"
    â†“
Claude è°ƒç”¨ Write å·¥å…·
    â†“
[PreToolUse Hook]
    - æ£€æµ‹åˆ° tests/ ç›®å½•
    - æ¨æ–­æ“ä½œ: add_function (è‡ªåŠ¨æ‰§è¡Œ)
    - è¿”å›: allowed = true
    â†“
Claude æ‰§è¡Œ Write
    â†“
[PostToolUse Hook]
    - æµ‹é‡ç»“æœ: æ–‡ä»¶å·²åˆ›å»º âœ“
    - æ›´æ–°ä¿¡ä»»: add_function æˆåŠŸç‡æå‡
    â†“
å®Œæˆ
```

### åœºæ™¯ 2: Claude ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶

```
ç”¨æˆ·: "ä¿®æ”¹ src/core/auth.py çš„è®¤è¯é€»è¾‘"
    â†“
Claude è°ƒç”¨ Edit å·¥å…·
    â†“
[PreToolUse Hook]
    - æ£€æµ‹åˆ° src/core/ ç›®å½•
    - æ¨æ–­æ“ä½œ: modify_core_logic (éœ€è¦å®¡æ‰¹)
    - è¿”å›: allowed = false, queued = true
    â†“
Claude æ”¶åˆ°é˜»æ­¢æ¶ˆæ¯
    â†“
ç”¨æˆ·ä½¿ç”¨ devops.py approve æ‰¹å‡†
    â†“
é‡æ–°æ‰§è¡Œ Edit
    â†“
[PostToolUse Hook]
    - æµ‹é‡ç»“æœ: æ–‡ä»¶å·²ä¿®æ”¹ âœ“
    - æ›´æ–°ä¿¡ä»»: modify_core_logic æˆåŠŸç‡æå‡
    â†“
å®Œæˆ
```

### åœºæ™¯ 3: ä½¿ç”¨ MCP å·¥å…·

```
ç”¨æˆ·: "æŸ¥çœ‹å½“å‰çš„è‡ªåŠ¨åŒ–ä¿¡ä»»åˆ†æ•°"
    â†“
Claude è°ƒç”¨ automation_get_trust MCP å·¥å…·
    â†“
[MCP æœåŠ¡å™¨]
    - è¯»å– .trust/scores.json
    - è¿”å›ä¿¡ä»»åˆ†æ•°
    â†“
Claude å‘ç”¨æˆ·å±•ç¤ºç»“æœ
```

## é…ç½®è¯´æ˜

### `.claude/settings.json`

```json
{
  "mcpServers": {
    "automation": {
      "command": "python3",
      "args": ["/path/to/mcp_automation_server.py"]
    }
  },
  "hooks": {
    "PreToolUse": {
      "command": "python3",
      "args": ["/path/to/.claude/hooks/automation.py", "--hook", "pre"],
      "async": true
    },
    "PostToolUse": {
      "command": "python3",
      "args": ["/path/to/.claude/hooks/automation.py", "--hook", "post"],
      "async": true
    }
  }
}
```

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: é€šè¿‡ Claude æ‰§è¡Œè‡ªåŠ¨åŒ–æ“ä½œ

```
ä½ : ä½¿ç”¨è‡ªåŠ¨åŒ–ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„å·¥å…·å‡½æ•°

Claude: æˆ‘å°†ä½¿ç”¨ automation_execute MCP å·¥å…·æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚

[è°ƒç”¨ automation_execute]
{
  "operation_type": "add_function",
  "description": "åˆ›å»ºå­—ç¬¦ä¸²å¤„ç†å·¥å…·",
  "file_path": "src/utils/string_tools.py"
}

[è¿”å›ç»“æœ]
{
  "status": "success",
  "result": {
    "file": "src/utils/string_tools.py",
    "action": "created_or_updated"
  }
}

âœ“ æ–‡ä»¶å·²åˆ›å»ºï¼Œä¸”æ“ä½œå·²è¢«è®°å½•åˆ°ä¿¡ä»»æ•°æ®åº“ã€‚
```

### ç¤ºä¾‹ 2: å®¡æ‰¹å†³ç­–é˜Ÿåˆ—

```
ä½ : æ˜¾ç¤ºå¾…å®¡æ‰¹çš„æ“ä½œ

Claude: [è°ƒç”¨ automation_get_queue]

å½“å‰å†³ç­–é˜Ÿåˆ—æœ‰ 3 é¡¹å¾…å¤„ç†:
1. [modify_core_logic] ä¿®æ”¹è®¤è¯æ¨¡å—
2. [add_dependency] æ·»åŠ æ•°æ®åº“é©±åŠ¨
3. [refactor_module] é‡æ„ç”¨æˆ·æœåŠ¡

ä½ : å…¨éƒ¨æ‰¹å‡†

Claude: [è°ƒç”¨ automation_approve_queue]

âœ“ å·²æ‰¹å‡†å¹¶æ‰§è¡Œ 3 é¡¹æ“ä½œ
```

### ç¤ºä¾‹ 3: æŸ¥çœ‹è‡ªåŠ¨åŒ–ç»Ÿè®¡

```
ä½ : ç”Ÿæˆè‡ªåŠ¨åŒ–å¼€å‘æŠ¥å‘Š

Claude: [è°ƒç”¨ automation_get_audit]

æœ€è¿‘ 7 å¤©çš„è‡ªåŠ¨åŒ–ç»Ÿè®¡:
- æ€»æ‰§è¡Œæ¬¡æ•°: 45
- è‡ªåŠ¨æ‰§è¡Œç‡: 87%
- æˆåŠŸç‡: 96%

[è°ƒç”¨ automation_get_trust]

ä¿¡ä»»åˆ†æ•°:
ğŸŸ¢ add_function: 100% (è‡ªåŠ¨)
ğŸŸ¢ update_documentation: 100% (è‡ªåŠ¨)
ğŸŸ¡ modify_core_logic: 82% (é€šçŸ¥)
ğŸ”´ add_dependency: 65% (éœ€è¦å®¡æ‰¹)
```

## è´Ÿåé¦ˆæ§åˆ¶å¾ªç¯

```
Claude æ‰§è¡Œæ“ä½œ
    â†“
æµ‹é‡ç»“æœ
    â†“
æˆåŠŸ? â”€â”€Yesâ”€â”€â†’ æ›´æ–°ä¿¡ä»»åˆ†æ•° (+)
    â”‚              â†“
    â”‚         è¾¾åˆ°é˜ˆå€¼?
    â”‚              â†“
    â”‚         Yes â†’ å‡çº§ä¸ºè‡ªåŠ¨æ‰§è¡Œ
    â”‚
   No â†“
è§¦å‘å›æ»š
    â†“
æ›´æ–°ä¿¡ä»»åˆ†æ•° (-)
    â†“
é™çº§æƒé™çº§åˆ«
    â†“
è®°å½•åˆ°å†³ç­–é˜Ÿåˆ—
```

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰è§„åˆ™

ç¼–è¾‘ `rules.json` æ¥è‡ªå®šä¹‰è‡ªåŠ¨åŒ–è¡Œä¸ºï¼š

```json
{
  "operations": {
    "add_function": {
      "autonomy_level": "auto",
      "test_required": true
    },
    "modify_core_logic": {
      "autonomy_level": "manual"
    }
  },
  "path_rules": {
    "src/core/**": {
      "override_level": "manual"
    }
  }
}
```

### Context7 é›†æˆ

ç»“åˆ Context7 æ’ä»¶ï¼ŒClaude å¯ä»¥è·å–é¡¹ç›®ç‰¹å®šçš„æ–‡æ¡£å’Œä¸Šä¸‹æ–‡ï¼š

```
ä½ : ä½¿ç”¨é¡¹ç›®çš„ä»£ç é£æ ¼åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°

Claude: [é€šè¿‡ Context7 è·å–é¡¹ç›®æ–‡æ¡£]
[é€šè¿‡ automation_get_trust æ£€æŸ¥è‡ªåŠ¨åŒ–çº§åˆ«]
[ä½¿ç”¨è‡ªåŠ¨åŒ–ç³»ç»Ÿæ‰§è¡Œ]
```

## æ•…éšœæ’é™¤

### Hook æœªè§¦å‘

æ£€æŸ¥ `.claude/settings.json` é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œè·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ã€‚

### MCP å·¥å…·ä¸å¯ç”¨

1. ç¡®ä¿ MCP æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥ Python ç¯å¢ƒ
3. æŸ¥çœ‹ MCP æœåŠ¡å™¨æ—¥å¿—

### æ“ä½œå§‹ç»ˆéœ€è¦å®¡æ‰¹

æ£€æŸ¥ `.trust/scores.json` ä¸­çš„å†å²è®°å½•ï¼Œç¡®ä¿æ“ä½œæœ‰è¶³å¤Ÿçš„æˆåŠŸè®°å½•ã€‚

## æœ€ä½³å®è·µ

1. **æ¸è¿›å¼ä¿¡ä»»**: è®©ç³»ç»Ÿä»å°æ“ä½œå¼€å§‹ï¼Œé€æ­¥å»ºç«‹ä¿¡ä»»
2. **æ‰¹é‡å†³ç­–**: ç´¯ç§¯å¤šä¸ªæ“ä½œåæ‰¹é‡å®¡æ‰¹ï¼Œå‡å°‘æ‰“æ‰°
3. **å®šæœŸå®¡è®¡**: ä½¿ç”¨ `automation_get_audit` å®šæœŸæ£€æŸ¥ç³»ç»ŸçŠ¶æ€
4. **å›æ»šå‡†å¤‡**: é‡è¦æ“ä½œå‰ä½¿ç”¨ `automation_create_rollback`

## æ‰©å±•

### æ·»åŠ æ–°çš„ MCP å·¥å…·

åœ¨ `mcp_automation_server.py` ä¸­æ·»åŠ ï¼š

```python
Tool(
    name="automation_your_tool",
    description="ä½ çš„å·¥å…·æè¿°",
    inputSchema={...}
)
```

### è‡ªå®šä¹‰ Hook è¡Œä¸º

åœ¨ `.claude/hooks/automation.py` ä¸­ä¿®æ”¹å¯¹åº”çš„å‡½æ•°ï¼š

```python
def pre_tool_use(input_data):
    # è‡ªå®šä¹‰é€»è¾‘
    return {"allowed": True, "custom_field": "value"}
```
